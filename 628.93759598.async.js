!(function(){"use strict";var ie=Object.defineProperty;var Vt=v=>{throw TypeError(v)};var se=(v,x,y)=>x in v?ie(v,x,{enumerable:!0,configurable:!0,writable:!0,value:y}):v[x]=y;var Dt=(v,x,y)=>se(v,typeof x!="symbol"?x+"":x,y),Et=(v,x,y)=>x.has(v)||Vt("Cannot "+y);var e=(v,x,y)=>(Et(v,x,"read from private field"),y?y.call(v):x.get(v)),u=(v,x,y)=>x.has(v)?Vt("Cannot add the same private member more than once"):x instanceof WeakSet?x.add(v):x.set(v,y),g=(v,x,y,ut)=>(Et(v,x,"write to private field"),ut?ut.call(v,y):x.set(v,y),y),c=(v,x,y)=>(Et(v,x,"access private method"),y);(self.webpackChunkreact_book_reader_docs=self.webpackChunkreact_book_reader_docs||[]).push([[628],{53628:function(v,x,y){var et,T,w,it,E,C,st,X,A,Y,I,nt,N,V,S,B,D,m,R,L,O,$,M,J,W,rt,at,ot,K,F,j,G,ht,a,Wt,_t,kt,Ct,zt,ct,jt,Q,U,Z,Ht,dt,St,Tt,xt,qt,Xt,q,Rt;y.r(x),y.d(x,{Paginator:function(){return wt}});const ut=h=>new Promise(r=>setTimeout(r,h)),Lt=(h,r,t)=>{let i;return(...s)=>{const n=()=>{i=null,h(...s)};i&&clearTimeout(i),i=setTimeout(n,r)}},vt=(h,r,t)=>t*(r-h)+h,Yt=h=>1-(1-h)*(1-h),Jt=(h,r,t,i,s)=>new Promise(n=>{let l;const o=d=>{if(document.hidden)return s(vt(h,r,1)),n();l??(l=d);const p=Math.min(1,(d-l)/t);s(vt(h,r,i(p))),p<1?requestAnimationFrame(o):n()};if(document.hidden)return s(vt(h,r,1)),n();requestAnimationFrame(o)}),Kt=h=>{if(!h?.collapsed)return h;const{endOffset:r,endContainer:t}=h;if(t.nodeType===1){const i=t.childNodes[r];return i?.nodeType===1?i:t}if(r+1<t.length)h.setEnd(t,r+1);else if(r>1)h.setStart(t,r-1);else return t.parentNode;return h},gt=(h,r,t,i=t)=>{const s=h.createRange();return s.setStart(r,t),s.setEnd(r,i),s},mt=(h,r,t,i=0,s=r.nodeValue.length)=>{if(s-i===1)return t(gt(h,r,i),gt(h,r,s))<0?i:s;const n=Math.floor(i+(s-i)/2),l=t(gt(h,r,i,n),gt(h,r,n,s));return l<0?mt(h,r,t,i,n):l>0?mt(h,r,t,n,s):n},{SHOW_ELEMENT:Gt,SHOW_TEXT:Qt,SHOW_CDATA_SECTION:Ut,FILTER_ACCEPT:Mt,FILTER_REJECT:At,FILTER_SKIP:$t}=NodeFilter,Zt=Gt|Qt|Ut,pt=h=>{let r=1/0,t=-1/0,i=1/0,s=-1/0;for(const n of h.getClientRects())i=Math.min(i,n.left),r=Math.min(r,n.top),t=Math.max(t,n.right),s=Math.max(s,n.bottom);return new DOMRect(i,r,t-i,s-r)},Pt=(h,r,t,i)=>{const s=f=>{const k=f.localName?.toLowerCase();if(k==="script"||k==="style")return At;if(f.nodeType===1){const{left:b,right:_}=i(f.getBoundingClientRect());if(_<r||b>t)return At;if(b>=r&&_<=t)return Mt}else{if(!f.nodeValue?.trim())return $t;const b=h.createRange();b.selectNodeContents(f);const{left:_,right:H}=i(b.getBoundingClientRect());if(H>=r&&_<=t)return Mt}return $t},n=h.createTreeWalker(h.body,Zt,{acceptNode:s}),l=[];for(let f=n.nextNode();f;f=n.nextNode())l.push(f);const o=l[0]??h.body,d=l[l.length-1]??o,p=o.nodeType===1?0:mt(h,o,(f,k)=>{const b=i(pt(f)),_=i(pt(k));return b.right<r&&_.left>r?0:_.left>r?-1:1}),P=d.nodeType===1?0:mt(h,d,(f,k)=>{const b=i(pt(f)),_=i(pt(k));return b.right<t&&_.left>t?0:_.left>t?-1:1}),z=h.createRange();return z.setStart(o,p),z.setEnd(d,P),z},It=h=>{const r=document.createRange();return r.setStart(h.anchorNode,h.anchorOffset),r.setEnd(h.focusNode,h.focusOffset),r.collapsed},ft=(h,r)=>{let t;if(h.startContainer?t=h.cloneRange():h.nodeType&&(t=document.createRange(),t.selectNode(h)),t){const i=t.startContainer.ownerDocument.defaultView.getSelection();i&&(i.removeAllRanges(),r===-1?t.collapse(!0):r===1&&t.collapse(),i.addRange(t))}},te=h=>{const{defaultView:r}=h,{writingMode:t,direction:i}=r.getComputedStyle(h.body),s=t==="vertical-rl"||t==="vertical-lr",n=h.body.dir==="rtl"||i==="rtl"||h.documentElement.dir==="rtl";return{vertical:s,rtl:n}},yt=h=>{const r=h.defaultView.getComputedStyle(h.body);return r.backgroundColor==="rgba(0, 0, 0, 0)"&&r.backgroundImage==="none"?h.defaultView.getComputedStyle(h.documentElement).background:r.background},Nt=(h,r)=>Array.from({length:h},()=>{const t=document.createElement("div"),i=document.createElement("div");return t.append(i),i.setAttribute("part",r),t}),tt=(h,r)=>{const{style:t}=h;for(const[i,s]of Object.entries(r))t.setProperty(i,s,"important")};class ee{constructor({container:r,onExpand:t}){u(this,et,new ResizeObserver(()=>this.expand()));u(this,T,document.createElement("div"));u(this,w,document.createElement("iframe"));u(this,it,document.createRange());u(this,E);u(this,C,!1);u(this,st,!1);u(this,X,!0);u(this,A);u(this,Y,{});this.container=r,this.onExpand=t,e(this,w).setAttribute("part","filter"),e(this,T).append(e(this,w)),Object.assign(e(this,T).style,{boxSizing:"content-box",position:"relative",overflow:"hidden",flex:"0 0 auto",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),Object.assign(e(this,w).style,{overflow:"hidden",border:"0",display:"none",width:"100%",height:"100%"}),e(this,w).setAttribute("sandbox","allow-same-origin allow-scripts"),e(this,w).setAttribute("scrolling","no")}get element(){return e(this,T)}get document(){return e(this,w).contentDocument}async load(r,t,i){if(typeof r!="string")throw new Error(`${r} is not string`);return new Promise(s=>{e(this,w).addEventListener("load",()=>{const n=this.document;t?.(n),e(this,w).style.display="block";const{vertical:l,rtl:o}=te(n),d=yt(n);e(this,w).style.display="none",g(this,C,l),g(this,st,o),e(this,it).selectNodeContents(n.body);const p=i?.({vertical:l,rtl:o,background:d});e(this,w).style.display="block",this.render(p),e(this,et).observe(n.body),n.fonts.ready.then(()=>this.expand()),s()},{once:!0}),e(this,w).src=r})}render(r){r&&(g(this,X,r.flow!=="scrolled"),g(this,Y,r),e(this,X)?this.columnize(r):this.scrolled(r))}scrolled({gap:r,columnWidth:t}){const i=e(this,C),s=this.document;tt(s.documentElement,{"box-sizing":"border-box",padding:i?`${r}px 0`:`0 ${r}px`,"column-width":"auto",height:"auto",width:"auto"}),tt(s.body,{[i?"max-height":"max-width"]:`${t}px`,margin:"auto"}),this.setImageSize(),this.expand()}columnize({width:r,height:t,gap:i,columnWidth:s}){const n=e(this,C);g(this,A,n?t:r);const l=this.document;tt(l.documentElement,{"box-sizing":"border-box","column-width":`${Math.trunc(s)}px`,"column-gap":`${i}px`,"column-fill":"auto",...n?{width:`${r}px`}:{height:`${t}px`},padding:n?`${i/2}px 0`:`0 ${i/2}px`,overflow:"hidden","overflow-wrap":"break-word",position:"static",border:"0",margin:"0","max-height":"none","max-width":"none","min-height":"none","min-width":"none","-webkit-line-box-contain":"block glyphs replaced"}),tt(l.body,{"max-height":"none","max-width":"none",margin:"0"}),this.setImageSize(),this.expand()}setImageSize(){const{width:r,height:t,margin:i}=e(this,Y),s=e(this,C),n=this.document;for(const l of n.body.querySelectorAll("img, svg, video")){const{maxHeight:o,maxWidth:d}=n.defaultView.getComputedStyle(l);tt(l,{"max-height":s?o!=="none"&&o!=="0px"?o:"100%":`${t-i*2}px`,"max-width":s?`${r-i*2}px`:d!=="none"&&d!=="0px"?d:"100%","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"})}}expand(){const{documentElement:r}=this.document;if(e(this,X)){const t=e(this,C)?"height":"width",i=e(this,C)?"width":"height",s=e(this,it).getBoundingClientRect(),n=r.getBoundingClientRect(),l=(e(this,C)?0:e(this,st)?n.right-s.right:s.left-n.left)+s[t],o=Math.ceil(l/e(this,A))*e(this,A);e(this,T).style.padding="0",e(this,w).style[t]=`${o}px`,e(this,T).style[t]=`${o+e(this,A)*2}px`,e(this,w).style[i]="100%",e(this,T).style[i]="100%",r.style[t]=`${e(this,A)}px`,e(this,E)&&(e(this,E).element.style.margin="0",e(this,E).element.style.left=e(this,C)?"0":`${e(this,A)}px`,e(this,E).element.style.top=e(this,C)?`${e(this,A)}px`:"0",e(this,E).element.style[t]=`${o}px`,e(this,E).redraw())}else{const t=e(this,C)?"width":"height",i=e(this,C)?"height":"width",s=r.getBoundingClientRect()[t],{margin:n}=e(this,Y),l=e(this,C)?`0 ${n}px`:`${n}px 0`;e(this,T).style.padding=l,e(this,w).style[t]=`${s}px`,e(this,T).style[t]=`${s}px`,e(this,w).style[i]="100%",e(this,T).style[i]="100%",e(this,E)&&(e(this,E).element.style.margin=l,e(this,E).element.style.left="0",e(this,E).element.style.top="0",e(this,E).element.style[t]=`${s}px`,e(this,E).redraw())}this.onExpand()}set overlayer(r){g(this,E,r),e(this,T).append(r.element)}get overlayer(){return e(this,E)}destroy(){this.document&&e(this,et).unobserve(this.document.body)}}et=new WeakMap,T=new WeakMap,w=new WeakMap,it=new WeakMap,E=new WeakMap,C=new WeakMap,st=new WeakMap,X=new WeakMap,A=new WeakMap,Y=new WeakMap;class wt extends HTMLElement{constructor(){super();u(this,a);u(this,I,this.attachShadow({mode:"closed"}));u(this,nt,new ResizeObserver(()=>this.render()));u(this,N);u(this,V);u(this,S);u(this,B);u(this,D);u(this,m);u(this,R,!1);u(this,L,!1);u(this,O,0);u(this,$,-1);u(this,M,0);u(this,J,!1);u(this,W,!1);u(this,rt);u(this,at,new WeakMap);u(this,ot,matchMedia("(prefers-color-scheme: dark)"));u(this,K);u(this,F);u(this,j);u(this,G);u(this,ht);e(this,I).innerHTML=`<style>
        :host {
            display: block;
            container-type: size;
        }
        :host, #top {
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        #top {
            --_gap: 7%;
            --_margin: 48px;
            --_max-inline-size: 720px;
            --_max-block-size: 1440px;
            --_max-column-count: 2;
            --_max-column-count-portrait: 1;
            --_max-column-count-spread: var(--_max-column-count);
            --_half-gap: calc(var(--_gap) / 2);
            --_max-width: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            --_max-height: var(--_max-block-size);
            display: grid;
            grid-template-columns:
                minmax(var(--_half-gap), 1fr)
                var(--_half-gap)
                minmax(0, calc(var(--_max-width) - var(--_gap)))
                var(--_half-gap)
                minmax(var(--_half-gap), 1fr);
            grid-template-rows:
                minmax(var(--_margin), 1fr)
                minmax(0, var(--_max-height))
                minmax(var(--_margin), 1fr);
            &.vertical {
                --_max-column-count-spread: var(--_max-column-count-portrait);
                --_max-width: var(--_max-block-size);
                --_max-height: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            }
            @container (orientation: portrait) {
                & {
                    --_max-column-count-spread: var(--_max-column-count-portrait);
                }
                &.vertical {
                    --_max-column-count-spread: var(--_max-column-count);
                }
            }
        }
        #background {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
        }
        #container {
            grid-column: 2 / 5;
            grid-row: 2;
            overflow: hidden;
        }
        :host([flow="scrolled"]) #container {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
            overflow: auto;
        }
        #header {
            grid-column: 3 / 4;
            grid-row: 1;
        }
        #footer {
            grid-column: 3 / 4;
            grid-row: 3;
            align-self: end;
        }
        #header, #footer {
            display: grid;
            height: var(--_margin);
        }
        :is(#header, #footer) > * {
            display: flex;
            align-items: center;
            min-width: 0;
        }
        :is(#header, #footer) > * > * {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            text-align: center;
            font-size: .75em;
            opacity: .6;
        }
        </style>
        <div id="top">
            <div id="background" part="filter"></div>
            <div id="header"></div>
            <div id="container"></div>
            <div id="footer"></div>
        </div>
        `,g(this,N,e(this,I).getElementById("top")),g(this,V,e(this,I).getElementById("background")),g(this,S,e(this,I).getElementById("container")),g(this,B,e(this,I).getElementById("header")),g(this,D,e(this,I).getElementById("footer")),e(this,nt).observe(e(this,S)),e(this,S).addEventListener("scroll",()=>this.dispatchEvent(new Event("scroll"))),e(this,S).addEventListener("scroll",Lt(()=>{this.scrolled&&(e(this,J)?g(this,J,!1):c(this,a,dt).call(this,"scroll"))},250));const t={passive:!1};this.addEventListener("touchstart",c(this,a,kt).bind(this),t),this.addEventListener("touchmove",c(this,a,Ct).bind(this),t),this.addEventListener("touchend",c(this,a,zt).bind(this)),this.addEventListener("load",({detail:{doc:s}})=>{s.addEventListener("touchstart",c(this,a,kt).bind(this),t),s.addEventListener("touchmove",c(this,a,Ct).bind(this),t),s.addEventListener("touchend",c(this,a,zt).bind(this))}),this.addEventListener("relocate",({detail:s})=>{s.reason==="selection"?ft(e(this,M),0):s.reason==="navigation"&&(e(this,M)===1?ft(s.range,1):typeof e(this,M)=="number"?ft(s.range,-1):ft(e(this,M),-1))});const i=Lt((s,n)=>{if(!n.rangeCount)return;const l=n.getRangeAt(0),o=It(n);o&&l.compareBoundaryPoints(Range.START_TO_START,s)<0?this.prev():!o&&l.compareBoundaryPoints(Range.END_TO_END,s)>0&&this.next()},700);this.addEventListener("load",({detail:{doc:s}})=>{let n=!1;s.addEventListener("pointerdown",()=>n=!0),s.addEventListener("pointerup",()=>n=!1);let l=!1;s.addEventListener("keydown",()=>l=!0),s.addEventListener("keyup",()=>l=!1),s.addEventListener("selectionchange",()=>{if(this.scrolled)return;const o=e(this,ht);if(!o)return;const d=s.getSelection();if(d.rangeCount){if(n&&d.type==="Range")i(o,d);else if(l){const p=d.getRangeAt(0).cloneRange();It(d)||p.collapse(),c(this,a,Z).call(this,p)}}}),s.addEventListener("focusin",o=>this.scrolled?null:requestAnimationFrame(()=>c(this,a,Z).call(this,o.target)))}),g(this,K,()=>{e(this,m)&&(e(this,V).style.background=yt(e(this,m).document))}),e(this,ot).addEventListener("change",e(this,K))}attributeChangedCallback(t,i,s){switch(t){case"flow":this.render();break;case"gap":case"margin":case"max-block-size":case"max-column-count":e(this,N).style.setProperty("--_"+t,s);break;case"max-inline-size":e(this,N).style.setProperty("--_"+t,s),this.render();break}}open(t){this.bookDir=t.dir,this.sections=t.sections,t.transformTarget?.addEventListener("data",({detail:i})=>{if(i.type!=="text/css")return;const s=innerWidth,n=innerHeight;i.data=Promise.resolve(i.data).then(l=>l.replace(new RegExp("(?<=[{\\s;])-epub-","gi"),"").replace(/(\d*\.?\d+)vw/gi,(o,d)=>parseFloat(d)*s/100+"px").replace(/(\d*\.?\d+)vh/gi,(o,d)=>parseFloat(d)*n/100+"px").replace(/page-break-(after|before|inside)\s*:/gi,(o,d)=>`-webkit-column-break-${d}:`).replace(/break-(after|before|inside)\s*:\s*(avoid-)?page/gi,(o,d,p)=>`break-${d}: ${p??""}column`))})}render(){e(this,m)&&(e(this,m).render(c(this,a,_t).call(this,{vertical:e(this,R),rtl:e(this,L)})),c(this,a,Z).call(this,e(this,M)))}get scrolled(){return this.getAttribute("flow")==="scrolled"}get scrollProp(){const{scrolled:t}=this;return e(this,R)?t?"scrollLeft":"scrollTop":t?"scrollTop":"scrollLeft"}get sideProp(){const{scrolled:t}=this;return e(this,R)?t?"width":"height":t?"height":"width"}get size(){return e(this,S).getBoundingClientRect()[this.sideProp]}get viewSize(){return e(this,m).element.getBoundingClientRect()[this.sideProp]}get start(){return Math.abs(e(this,S)[this.scrollProp])}get end(){return this.start+this.size}get page(){return Math.floor((this.start+this.end)/2/this.size)}get pages(){return Math.round(this.viewSize/this.size)}scrollBy(t,i){const s=e(this,R)?i:t,n=e(this,S),{scrollProp:l}=this,[o,d,p]=e(this,F),P=e(this,L),z=P?o-p:o-d,f=P?o+d:o+p;n[l]=Math.max(z,Math.min(f,n[l]+s))}snap(t,i){const s=e(this,R)?i:t,[n,l,o]=e(this,F),{start:d,end:p,pages:P,size:z}=this,f=Math.abs(n)-l,k=Math.abs(n)+o,b=s*(e(this,L)?-z:z),_=Math.floor(Math.max(f,Math.min(k,(d+p)/2+(isNaN(b)?0:b)))/z);c(this,a,U).call(this,_,"snap").then(()=>{const H=_<=0?-1:_>=P-1?1:null;if(H)return c(this,a,xt).call(this,{index:c(this,a,q).call(this,H),anchor:H<0?()=>1:()=>0})})}async scrollToAnchor(t,i){return c(this,a,Z).call(this,t,i?"selection":"navigation")}async goTo(t){if(e(this,W))return;const i=await t;if(c(this,a,Tt).call(this,i.index))return c(this,a,xt).call(this,i)}get atStart(){return c(this,a,q).call(this,-1)==null&&this.page<=1}get atEnd(){return c(this,a,q).call(this,1)==null&&this.page>=this.pages-2}prev(t){return c(this,a,Rt).call(this,-1,t)}next(t){return c(this,a,Rt).call(this,1,t)}prevSection(){return this.goTo({index:c(this,a,q).call(this,-1)})}nextSection(){return this.goTo({index:c(this,a,q).call(this,1)})}firstSection(){const t=this.sections.findIndex(i=>i.linear!=="no");return this.goTo({index:t})}lastSection(){const t=this.sections.findLastIndex(i=>i.linear!=="no");return this.goTo({index:t})}getContents(){return e(this,m)?[{index:e(this,$),overlayer:e(this,m).overlayer,doc:e(this,m).document}]:[]}setStyles(t){g(this,rt,t);const i=e(this,at).get(e(this,m)?.document);if(!i)return;const[s,n]=i;if(Array.isArray(t)){const[l,o]=t;s.textContent=l,n.textContent=o}else n.textContent=t;requestAnimationFrame(()=>e(this,V).style.background=yt(e(this,m).document)),e(this,m)?.document?.fonts?.ready?.then(()=>e(this,m).expand())}focusView(){e(this,m).document.defaultView.focus()}destroy(){e(this,nt).unobserve(this),e(this,m).destroy(),g(this,m,null),this.sections[e(this,$)]?.unload?.(),e(this,ot).removeEventListener("change",e(this,K))}}I=new WeakMap,nt=new WeakMap,N=new WeakMap,V=new WeakMap,S=new WeakMap,B=new WeakMap,D=new WeakMap,m=new WeakMap,R=new WeakMap,L=new WeakMap,O=new WeakMap,$=new WeakMap,M=new WeakMap,J=new WeakMap,W=new WeakMap,rt=new WeakMap,at=new WeakMap,ot=new WeakMap,K=new WeakMap,F=new WeakMap,j=new WeakMap,G=new WeakMap,ht=new WeakMap,a=new WeakSet,Wt=function(){return e(this,m)&&(e(this,m).destroy(),e(this,S).removeChild(e(this,m).element)),g(this,m,new ee({container:this,onExpand:()=>c(this,a,Z).call(this,e(this,M))})),e(this,S).append(e(this,m).element),e(this,m)},_t=function({vertical:t,rtl:i,background:s}){g(this,R,t),g(this,L,i),e(this,N).classList.toggle("vertical",t),e(this,V).style.background=s;const{width:n,height:l}=e(this,S).getBoundingClientRect(),o=t?l:n,d=getComputedStyle(e(this,N)),p=parseFloat(d.getPropertyValue("--_max-inline-size")),P=parseInt(d.getPropertyValue("--_max-column-count-spread")),z=parseFloat(d.getPropertyValue("--_margin"));g(this,O,z);const f=parseFloat(d.getPropertyValue("--_gap"))/100,k=-f/(f-1)*o,b=this.getAttribute("flow");if(b==="scrolled"){this.setAttribute("dir",t?"rtl":"ltr"),e(this,N).style.padding="0";const lt=p;return this.heads=null,this.feet=null,e(this,B).replaceChildren(),e(this,D).replaceChildren(),{flow:b,margin:z,gap:k,columnWidth:lt}}const _=Math.min(P,Math.ceil(o/p)),H=o/_-k;this.setAttribute("dir",i?"rtl":"ltr");const bt=t?Math.min(2,Math.ceil(n/p)):_,Bt={gridTemplateColumns:`repeat(${bt}, 1fr)`,gap:`${k}px`,direction:this.bookDir==="rtl"?"rtl":"ltr"};Object.assign(e(this,B).style,Bt),Object.assign(e(this,D).style,Bt);const Ot=Nt(bt,"head"),Ft=Nt(bt,"foot");return this.heads=Ot.map(lt=>lt.children[0]),this.feet=Ft.map(lt=>lt.children[0]),e(this,B).replaceChildren(...Ot),e(this,D).replaceChildren(...Ft),{height:l,width:n,margin:z,gap:k,columnWidth:H}},kt=function(t){const i=t.changedTouches[0];g(this,j,{x:i?.screenX,y:i?.screenY,t:t.timeStamp,vx:0,xy:0})},Ct=function(t){const i=e(this,j);if(i.pinched||(i.pinched=globalThis.visualViewport.scale>1,this.scrolled||i.pinched))return;if(t.touches.length>1){e(this,G)&&t.preventDefault();return}t.preventDefault();const s=t.changedTouches[0],n=s.screenX,l=s.screenY,o=i.x-n,d=i.y-l,p=t.timeStamp-i.t;i.x=n,i.y=l,i.t=t.timeStamp,i.vx=o/p,i.vy=d/p,g(this,G,!0),this.scrollBy(o,d)},zt=function(){g(this,G,!1),!this.scrolled&&requestAnimationFrame(()=>{globalThis.visualViewport.scale===1&&this.snap(e(this,j).vx,e(this,j).vy)})},ct=function(){if(this.scrolled){const i=this.viewSize,s=e(this,O);return e(this,R)?({left:n,right:l})=>({left:i-l-s,right:i-n-s}):({top:n,bottom:l})=>({left:n+s,right:l+s})}const t=this.pages*this.size;return e(this,L)?({left:i,right:s})=>({left:t-s,right:t-i}):e(this,R)?({top:i,bottom:s})=>({left:i,right:s}):i=>i},jt=async function(t,i){if(this.scrolled){const n=c(this,a,ct).call(this)(t).left-e(this,O);return c(this,a,Q).call(this,n,i)}const s=c(this,a,ct).call(this)(t).left;return c(this,a,U).call(this,Math.floor(s/this.size)+(e(this,L)?-1:1),i)},Q=async function(t,i,s){const n=e(this,S),{scrollProp:l,size:o}=this;if(n[l]===t){g(this,F,[t,this.atStart?0:o,this.atEnd?0:o]),c(this,a,dt).call(this,i);return}if(this.scrolled&&e(this,R)&&(t=-t),(i==="snap"||s)&&this.hasAttribute("animated"))return Jt(n[l],t,300,Yt,d=>n[l]=d).then(()=>{g(this,F,[t,this.atStart?0:o,this.atEnd?0:o]),c(this,a,dt).call(this,i)});n[l]=t,g(this,F,[t,this.atStart?0:o,this.atEnd?0:o]),c(this,a,dt).call(this,i)},U=async function(t,i,s){const n=this.size*(e(this,L)?-t:t);return c(this,a,Q).call(this,n,i,s)},Z=async function(t,i="anchor"){g(this,M,t);const s=Kt(t)?.getClientRects?.();if(s){const d=Array.from(s).find(p=>p.width>0&&p.height>0)||s[0];if(!d)return;await c(this,a,jt).call(this,d,i);return}if(this.scrolled){await c(this,a,Q).call(this,t*this.viewSize,i);return}const{pages:n}=this;if(!n)return;const l=n-2,o=Math.round(t*(l-1));await c(this,a,U).call(this,o+1,i)},Ht=function(){if(this.scrolled)return Pt(e(this,m).document,this.start+e(this,O),this.end-e(this,O),c(this,a,ct).call(this));const t=e(this,L)?-this.size:this.size;return Pt(e(this,m).document,this.start-t,this.end-t,c(this,a,ct).call(this))},dt=function(t){const i=c(this,a,Ht).call(this);g(this,ht,i),t!=="selection"&&t!=="navigation"&&t!=="anchor"?g(this,M,i):g(this,J,!0);const s=e(this,$),n={reason:t,range:i,index:s};if(this.scrolled)n.fraction=this.start/this.viewSize;else if(this.pages>0){const{page:l,pages:o}=this;e(this,B).style.visibility=l>1?"visible":"hidden",n.fraction=(l-1)/(o-2),n.size=1/(o-2)}this.dispatchEvent(new CustomEvent("relocate",{detail:n}))},St=async function(t){const{index:i,src:s,anchor:n,onLoad:l,select:o}=await t;g(this,$,i);const d=e(this,m)?.document?.hasFocus();if(s){const p=c(this,a,Wt).call(this),P=f=>{if(f.head){const k=f.createElement("style");f.head.prepend(k);const b=f.createElement("style");f.head.append(b),e(this,at).set(f,[k,b])}l?.({doc:f,index:i})},z=c(this,a,_t).bind(this);await p.load(s,P,z),this.dispatchEvent(new CustomEvent("create-overlayer",{detail:{doc:p.document,index:i,attach:f=>p.overlayer=f}})),g(this,m,p)}await this.scrollToAnchor((typeof n=="function"?n(e(this,m).document):n)??0,o),d&&this.focusView()},Tt=function(t){return t>=0&&t<=this.sections.length-1},xt=async function({index:t,anchor:i,select:s}){if(t===e(this,$))await c(this,a,St).call(this,{index:t,anchor:i,select:s});else{const n=e(this,$),l=o=>{this.sections[n]?.unload?.(),this.setStyles(e(this,rt)),this.dispatchEvent(new CustomEvent("load",{detail:o}))};await c(this,a,St).call(this,Promise.resolve(this.sections[t].load()).then(o=>({index:t,src:o,anchor:i,onLoad:l,select:s})).catch(o=>(console.warn(o),console.warn(new Error(`Failed to load section ${t}`)),{})))}},qt=function(t){if(!e(this,m))return!0;if(this.scrolled)return this.start>0?c(this,a,Q).call(this,Math.max(0,this.start-(t??this.size)),null,!0):!0;if(this.atStart)return;const i=this.page-1;return c(this,a,U).call(this,i,"page",!0).then(()=>i<=0)},Xt=function(t){if(!e(this,m))return!0;if(this.scrolled)return this.viewSize-this.end>2?c(this,a,Q).call(this,Math.min(this.viewSize,t?this.start+t:this.end),null,!0):!0;if(this.atEnd)return;const i=this.page+1,s=this.pages;return c(this,a,U).call(this,i,"page",!0).then(()=>i>=s-1)},q=function(t){for(let i=e(this,$)+t;c(this,a,Tt).call(this,i);i+=t)if(this.sections[i]?.linear!=="no")return i},Rt=async function(t,i){if(e(this,W))return;g(this,W,!0);const s=t===-1,n=await(s?c(this,a,qt).call(this,i):c(this,a,Xt).call(this,i));n&&await c(this,a,xt).call(this,{index:c(this,a,q).call(this,t),anchor:s?()=>1:()=>0}),(n||!this.hasAttribute("animated"))&&await ut(100),g(this,W,!1)},Dt(wt,"observedAttributes",["flow","gap","margin","max-inline-size","max-block-size","max-column-count"]),customElements.define("foliate-paginator",wt)}}]);
}());