!(function(){"use strict";var O=a=>{throw TypeError(a)};var D=(a,u,m)=>u.has(a)||O("Cannot "+m);var n=(a,u,m)=>(D(a,u,"read from private field"),m?m.call(a):u.get(a)),N=(a,u,m)=>u.has(a)?O("Cannot add the same private member more than once"):u instanceof WeakSet?u.add(a):u.set(a,m),d=(a,u,m,c)=>(D(a,u,"write to private field"),c?c.call(a,m):u.set(a,m),m),M=(a,u,m)=>(D(a,u,"access private method"),m);(self.webpackChunkreact_book_reader_docs=self.webpackChunkreact_book_reader_docs||[]).push([[866],{79866:function(a,u,m){var l,y,g,p,k,x,b,v,S,R,C;m.d(u,{TTS:function(){return $}});const c={XML:"http://www.w3.org/XML/1998/namespace",SSML:"http://www.w3.org/2001/10/synthesis"},q=new Set(["article","aside","audio","blockquote","caption","details","dialog","div","dl","dt","dd","figure","footer","form","figcaption","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","math","nav","ol","p","pre","section","tr"]),W=s=>s.lang||s?.getAttributeNS?.(c.XML,"lang")||(s.parentElement?W(s.parentElement):null),z=s=>s?.getAttributeNS?.(c.XML,"lang")||(s.parentElement?z(s.parentElement):null),I=(s="en",t="word")=>{const e=new Intl.Segmenter(s,{granularity:t}),i=t==="word";return function*(r,h){const L=r.join("");let _=0,o=-1,f=0;for(const{index:E,segment:A,isWordLike:w}of e.segment(L)){if(i&&!w)continue;for(;f<=E;)f+=r[++o].length;const T=o,G=E-(f-r[o].length),X=E+A.length-1;if(X<L.length)for(;f<=X;)f+=r[++o].length;const J=o,K=X-(f-r[o].length)+1;yield[(_++).toString(),h(T,G,J,K)]}}},P=(s,t)=>{const e=document.implementation.createDocument(c.SSML,"speak"),{lang:i}=t;i&&e.documentElement.setAttributeNS(c.XML,"lang",i);const r=(h,L,_)=>{if(!h)return;if(h.nodeType===3)return e.createTextNode(h.textContent);if(h.nodeType===4)return e.createCDATASection(h.textContent);if(h.nodeType!==1)return;let o;const f=h.nodeName.toLowerCase();f==="foliate-mark"?(o=e.createElementNS(c.SSML,"mark"),o.setAttribute("name",h.dataset.name)):f==="br"?o=e.createElementNS(c.SSML,"break"):(f==="em"||f==="strong")&&(o=e.createElementNS(c.SSML,"emphasis"));const E=h.lang||h.getAttributeNS(c.XML,"lang");E&&(o||(o=e.createElementNS(c.SSML,"lang")),o.setAttributeNS(c.XML,"lang",E));const A=h.getAttributeNS(c.SSML,"alphabet")||_;if(!o){const T=h.getAttributeNS(c.SSML,"ph");T&&(o=e.createElementNS(c.SSML,"phoneme"),A&&o.setAttribute("alphabet",A),o.setAttribute("ph",T))}o||(o=L);let w=h.firstChild;for(;w;){const T=r(w,o,A);T&&o!==T&&o.append(T),w=w.nextSibling}return o};return r(s.firstChild,e.documentElement,t.alphabet),e},j=(s,t,e)=>{const i=W(s.commonAncestorContainer),r=z(s.commonAncestorContainer),h=I(i,e),L=s.cloneContents(),_=[...t(s,h)],o=[...t(L,h)];for(const[E,A]of o){const w=document.createElement("foliate-mark");w.dataset.name=E,A.insertNode(w)}const f=P(L,{lang:i,alphabet:r});return{entries:_,ssml:f}},B=s=>!s.toString().trim();function*F(s){let t;const e=s.createTreeWalker(s.body,NodeFilter.SHOW_ELEMENT);for(let i=e.nextNode();i;i=e.nextNode()){const r=i.tagName.toLowerCase();q.has(r)&&(t&&(t.setEndBefore(i),B(t)||(yield t)),t=s.createRange(),t.setStart(i,0))}t||(t=s.createRange(),t.setStart(s.body.firstChild??s.body,0)),t.setEndAfter(s.body.lastChild??s.body),B(t)||(yield t)}class H{constructor(t,e=i=>i){N(this,l,[]);N(this,y);N(this,g,-1);N(this,p);d(this,y,t),d(this,p,e)}current(){if(n(this,l)[n(this,g)])return n(this,p).call(this,n(this,l)[n(this,g)])}first(){if(n(this,l)[0])return d(this,g,0),n(this,p).call(this,n(this,l)[0])}prev(){const t=n(this,g)-1;if(n(this,l)[t])return d(this,g,t),n(this,p).call(this,n(this,l)[t])}next(){const t=n(this,g)+1;if(n(this,l)[t])return d(this,g,t),n(this,p).call(this,n(this,l)[t]);for(;;){const{done:e,value:i}=n(this,y).next();if(e)break;if(n(this,l).push(i),n(this,l)[t])return d(this,g,t),n(this,p).call(this,n(this,l)[t])}}find(t){const e=n(this,l).findIndex(i=>t(i));if(e>-1)return d(this,g,e),n(this,p).call(this,n(this,l)[e]);for(;;){const{done:i,value:r}=n(this,y).next();if(i)break;if(n(this,l).push(r),t(r))return d(this,g,n(this,l).length-1),n(this,p).call(this,r)}}}l=new WeakMap,y=new WeakMap,g=new WeakMap,p=new WeakMap;class ${constructor(t,e,i,r){N(this,S);N(this,k);N(this,x);N(this,b);N(this,v,new XMLSerializer);this.doc=t,this.highlight=i,d(this,k,new H(F(t),h=>{const{entries:L,ssml:_}=j(h,e,r);return d(this,x,new Map(L)),[_,h]}))}start(){d(this,b,null);const[t]=n(this,k).first()??[];return t?M(this,S,C).call(this,t,e=>M(this,S,R).call(this,e,n(this,b))):this.next()}resume(){const[t]=n(this,k).current()??[];return t?M(this,S,C).call(this,t,e=>M(this,S,R).call(this,e,n(this,b))):this.next()}prev(t){d(this,b,null);const[e,i]=n(this,k).prev()??[];return t&&i&&this.highlight(i.cloneRange()),M(this,S,C).call(this,e)}next(t){d(this,b,null);const[e,i]=n(this,k).next()??[];return t&&i&&this.highlight(i.cloneRange()),M(this,S,C).call(this,e)}from(t){d(this,b,null);const[e]=n(this,k).find(r=>t.compareBoundaryPoints(Range.END_TO_START,r)<=0);let i;for(const[r,h]of n(this,x).entries())if(t.compareBoundaryPoints(Range.START_TO_START,h)<=0){i=r;break}return M(this,S,C).call(this,e,r=>M(this,S,R).call(this,r,i))}setMark(t){const e=n(this,x).get(t);e&&(d(this,b,t),this.highlight(e.cloneRange()))}}k=new WeakMap,x=new WeakMap,b=new WeakMap,v=new WeakMap,S=new WeakSet,R=function(t,e){return e?t.querySelector(`mark[name="${CSS.escape(e)}"`):null},C=function(t,e){if(!t)return;if(!e)return n(this,v).serializeToString(t);const i=document.implementation.createDocument(c.SSML,"speak");i.documentElement.replaceWith(i.importNode(t.documentElement,!0));let r=e(i)?.previousSibling;for(;r;){const h=r.previousSibling??r.parentNode?.previousSibling;r.parentNode.removeChild(r),r=h}return n(this,v).serializeToString(i)}}}]);
}());