"use strict";(self.webpackChunkreact_book_reader_docs=self.webpackChunkreact_book_reader_docs||[]).push([[70],{79070:function(K,z,B){B.d(z,{TTS:function(){return H}});var x=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)},n=(i,t,e)=>(x(i,t,"read from private field"),e?e.call(i):t.get(i)),p=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},h=(i,t,e,r)=>(x(i,t,"write to private field"),r?r.call(i,e):t.set(i,e),e),b=(i,t,e)=>(x(i,t,"access private method"),e);const c={XML:"http://www.w3.org/XML/1998/namespace",SSML:"http://www.w3.org/2001/10/synthesis"},O=new Set(["article","aside","audio","blockquote","caption","details","dialog","div","dl","dt","dd","figure","footer","form","figcaption","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","math","nav","ol","p","pre","section","tr"]),R=i=>{var t;return i.lang||((t=i?.getAttributeNS)==null?void 0:t.call(i,c.XML,"lang"))||(i.parentElement?R(i.parentElement):null)},X=i=>{var t;return((t=i?.getAttributeNS)==null?void 0:t.call(i,c.XML,"lang"))||(i.parentElement?X(i.parentElement):null)},q=(i="en",t="word")=>{const e=new Intl.Segmenter(i,{granularity:t}),r=t==="word";return function*(s,o){const m=s.join("");let y=0,a=-1,u=0;for(const{index:w,segment:N,isWordLike:S}of e.segment(m)){if(r&&!S)continue;for(;u<=w;)u+=s[++a].length;const k=a,G=w-(u-s[a].length),W=w+N.length;if(W<m.length)for(;u<=W;)u+=s[++a].length;const $=a,J=W-(u-s[a].length);yield[(y++).toString(),o(k,G,$,J)]}}},I=(i,t)=>{const e=document.implementation.createDocument(c.SSML,"speak"),{lang:r}=t;r&&e.documentElement.setAttributeNS(c.XML,"lang",r);const s=(o,m,y)=>{if(!o)return;if(o.nodeType===3)return e.createTextNode(o.textContent);if(o.nodeType===4)return e.createCDATASection(o.textContent);if(o.nodeType!==1)return;let a;const u=o.nodeName.toLowerCase();u==="foliate-mark"?(a=e.createElementNS(c.SSML,"mark"),a.setAttribute("name",o.dataset.name)):u==="br"?a=e.createElementNS(c.SSML,"break"):(u==="em"||u==="strong")&&(a=e.createElementNS(c.SSML,"emphasis"));const w=o.lang||o.getAttributeNS(c.XML,"lang");w&&(a||(a=e.createElementNS(c.SSML,"lang")),a.setAttributeNS(c.XML,"lang",w));const N=o.getAttributeNS(c.SSML,"alphabet")||y;if(!a){const k=o.getAttributeNS(c.SSML,"ph");k&&(a=e.createElementNS(c.SSML,"phoneme"),N&&a.setAttribute("alphabet",N),a.setAttribute("ph",k))}a||(a=m);let S=o.firstChild;for(;S;){const k=s(S,a,N);k&&a!==k&&a.append(k),S=S.nextSibling}return a};return s(i.firstChild,e.documentElement,t.alphabet),e},P=(i,t,e)=>{const r=R(i.commonAncestorContainer),s=X(i.commonAncestorContainer),o=q(r,e),m=i.cloneContents(),y=[...t(i,o)],a=[...t(m,o)];for(const[w,N]of a){const S=document.createElement("foliate-mark");S.dataset.name=w,N.insertNode(S)}const u=I(m,{lang:r,alphabet:s});return{entries:y,ssml:u}},D=i=>!i.toString().trim();function*j(i){let t;const e=i.createTreeWalker(i.body,NodeFilter.SHOW_ELEMENT);for(let r=e.nextNode();r;r=e.nextNode()){const s=r.tagName.toLowerCase();O.has(s)&&(t&&(t.setEndBefore(r),D(t)||(yield t)),t=i.createRange(),t.setStart(r,0))}t||(t=i.createRange(),t.setStart(i.body.firstChild??i.body,0)),t.setEndAfter(i.body.lastChild??i.body),D(t)||(yield t)}var l,L,d,f;class F{constructor(t,e=r=>r){p(this,l,[]),p(this,L,void 0),p(this,d,-1),p(this,f,void 0),h(this,L,t),h(this,f,e)}current(){if(n(this,l)[n(this,d)])return n(this,f).call(this,n(this,l)[n(this,d)])}first(){if(n(this,l)[0])return h(this,d,0),n(this,f).call(this,n(this,l)[0])}prev(){const t=n(this,d)-1;if(n(this,l)[t])return h(this,d,t),n(this,f).call(this,n(this,l)[t])}next(){const t=n(this,d)+1;if(n(this,l)[t])return h(this,d,t),n(this,f).call(this,n(this,l)[t]);for(;;){const{done:e,value:r}=n(this,L).next();if(e)break;if(n(this,l).push(r),n(this,l)[t])return h(this,d,t),n(this,f).call(this,n(this,l)[t])}}find(t){const e=n(this,l).findIndex(r=>t(r));if(e>-1)return h(this,d,e),n(this,f).call(this,n(this,l)[e]);for(;;){const{done:r,value:s}=n(this,L).next();if(r)break;if(n(this,l).push(s),t(s))return h(this,d,n(this,l).length-1),n(this,f).call(this,s)}}}l=new WeakMap,L=new WeakMap,d=new WeakMap,f=new WeakMap;var v,T,g,A,_,C,M,E;class H{constructor(t,e,r){p(this,_),p(this,M),p(this,v,void 0),p(this,T,void 0),p(this,g,void 0),p(this,A,new XMLSerializer),this.doc=t,this.highlight=r,h(this,v,new F(j(t),s=>{const{entries:o,ssml:m}=P(s,e);return h(this,T,new Map(o)),[m,s]}))}start(){h(this,g,null);const[t]=n(this,v).first()??[];return t?b(this,M,E).call(this,t,e=>b(this,_,C).call(this,e,n(this,g))):this.next()}resume(){const[t]=n(this,v).current()??[];return t?b(this,M,E).call(this,t,e=>b(this,_,C).call(this,e,n(this,g))):this.next()}prev(t){h(this,g,null);const[e,r]=n(this,v).prev()??[];return t&&r&&this.highlight(r.cloneRange()),b(this,M,E).call(this,e)}next(t){h(this,g,null);const[e,r]=n(this,v).next()??[];return t&&r&&this.highlight(r.cloneRange()),b(this,M,E).call(this,e)}from(t){h(this,g,null);const[e]=n(this,v).find(s=>t.compareBoundaryPoints(Range.END_TO_START,s)<=0);let r;for(const[s,o]of n(this,T).entries())if(t.compareBoundaryPoints(Range.START_TO_START,o)<=0){r=s;break}return b(this,M,E).call(this,e,s=>b(this,_,C).call(this,s,r))}setMark(t){const e=n(this,T).get(t);e&&(h(this,g,t),this.highlight(e.cloneRange()))}}v=new WeakMap,T=new WeakMap,g=new WeakMap,A=new WeakMap,_=new WeakSet,C=function(i,t){return t?i.querySelector(`mark[name="${CSS.escape(t)}"`):null},M=new WeakSet,E=function(i,t){var e,r;if(!i)return;if(!t)return n(this,A).serializeToString(i);const s=document.implementation.createDocument(c.SSML,"speak");s.documentElement.replaceWith(s.importNode(i.documentElement,!0));let o=(e=t(s))==null?void 0:e.previousSibling;for(;o;){const m=o.previousSibling??((r=o.parentNode)==null?void 0:r.previousSibling);o.parentNode.removeChild(o),o=m}return n(this,A).serializeToString(s)}}}]);
